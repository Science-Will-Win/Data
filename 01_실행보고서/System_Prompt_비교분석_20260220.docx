**AIGEN BioAgent**

**System Prompt 비교 분석 보고서**

  -----------------------------------------------------------------------
  **항목**        **내용**
  --------------- -------------------------------------------------------
  작성일          2026-02-20

  작성자          박정훈 (Phase 1 리드)

  목적            Phase 1 실제 사용 프롬프트 vs Phase 2 합의 문서
                  프롬프트 차이 분석

  배경            이상훈 수석님 지적: \"system prompt가 왜 논의한거랑
                  다르게 들어가 있나요\"

  참조 문서       1\) SWW_합의사항_정리내용 (Google Doc) 2) System prompt
                  for the Aigen R0 (Google Doc)
  -----------------------------------------------------------------------

# 1. 개요

Phase 2 팀이 작성한 System Prompt 문서에는 총 5종의 프롬프트가 정의되어
있습니다. 이 문서는 각 프롬프트가 Phase 1 데이터 수집 시 어떻게
적용되었는지, 차이점은 무엇인지를 분석합니다.

  -----------------------------------------------------------------------------
  **\#**   **프롬프트 종류**     **용도**         **Phase 1 적용 여부**
  -------- --------------------- ---------------- -----------------------------
  1        System prompt for     R0 모델 추론용   **⚠️ 미확정**
           Aigen R0                               

  2        System prompt for GPT GPT 에이전트     **🟡 유사**
                                 실행용           

  3        System prompt for     도구 선택용      **🟡 유사**
           Tool Retriever GPT                     

  4        System prompt for     논문 분석용      **--- 해당 없음**
           Action Discovery                       
           Agent                                  

  5        System prompt for GPT A1 에이전트      **🔴 차이 있음**
           (Biomni A1)           실행용 (도메인   
                                 지식 포함)       
  -----------------------------------------------------------------------------

# 2. 프롬프트별 상세 비교

## 2.1 System Prompt for Aigen R0

  -----------------------------------------------------------------------
  **구분**           **내용**
  ------------------ ----------------------------------------------------
  Phase 2 합의 문서  \"ddd\" --- placeholder 상태, 실제 프롬프트 미작성

  Phase 1 실제 사용  Biomni 패키지 내장 기본 프롬프트 (biomni.agent.A1
                     클래스 내부)

  판정               ⚠️ Phase 2에서 R0용 프롬프트를 아직 확정하지 않은
                     상태
  -----------------------------------------------------------------------

> **분석:** R0 프롬프트가 \"ddd\"로 비어있으므로, 불일치가 아니라
> \"미확정\" 상태입니다. Phase 1은 확정본이 없어 Biomni 기본값을 사용한
> 것이 합리적 선택이었습니다.
>
> **조치 필요:** Phase 2 팀(완수/재현)에게 R0 커스텀 프롬프트 확정
> 일정을 확인해야 합니다. 확정 시 재수집 필요 여부도 함께 논의해야
> 합니다.

## 2.2 System Prompt for GPT

Phase 2 문서의 GPT 프롬프트와 Biomni A1 내장 프롬프트는 구조가 거의
동일합니다. Biomni A1 기본 프롬프트를 기반으로 작성된 것으로 판단됩니다.

  -----------------------------------------------------------------------
  **비교 항목** **Phase 2 합의 문서**  **Phase 1 실제 사용  **일치 여부**
                                       (A1 내장)**          
  ------------- ---------------------- -------------------- -------------
  역할 정의     \"You are Aigen R0, a  \"You are a helpful  **🔴 차이
                helpful biomedical     biomedical           있음**
                assistant\"            assistant\"          

  계획 수립     체크리스트: \[ \] →    동일한 체크리스트    **✅ 일치**
  방식          \[✓\] → \[✗\]          구조                 

  코드 실행     \<execute\> /          동일 태그 사용       **✅ 일치**
  태그          \<solution\> 태그                           

  R/Bash 지원   #!R, #!BASH 마커       동일 마커 지원       **✅ 일치**

  도구 목록     {function_intro},      A1이 retriever 통해  **🟡 유사**
  삽입          {tool_desc} 템플릿     자동 삽입            
                변수                                        

  Data Lake     S3 버킷 경로 포함      A1이 자동 포함       **🟡 유사**
  경로                                                      

  출력 저장     /tmp/agent_outputs/    A1 내장에도 동일     **✅ 일치**
  경로          지정                                        

  모델 이름     \"Aigen R0\"로 명명    모델 이름 미지정     **🔴 차이
                                       (기본값)             있음**
  -----------------------------------------------------------------------

> **분석:** 핵심 구조(계획 수립, 코드 실행, 태그 형식)는 완전히
> 일치합니다. 차이는 모델 이름(\"Aigen R0\" vs 기본값)과 도구 삽입
> 방식(템플릿 변수 vs 자동 처리)에 한정됩니다. 이 차이가 trajectory
> 품질에 미치는 영향은 미미합니다.

## 2.3 System Prompt for Tool Retriever GPT

  ----------------------------------------------------------------------------
  **비교 항목** **Phase 2 합의 문서**       **Phase 1 실제       **일치 여부**
                                            사용**               
  ------------- --------------------------- -------------------- -------------
  역할          쿼리 기반                   A1 내장 retriever가  **🟡 유사**
                tools/data_lake/libraries   동일 역할 수행       
                인덱스 선택                                      

  선택 기준     \"generous\" --- 많이 포함, A1 내장 retriever의  **🟡 유사**
                DB/문헌/분자생물 도구 우선  기본 로직            

  출력 형식     TOOLS: \[인덱스\],          A1 내부 포맷 (동일   **🟡 유사**
                DATA_LAKE: \[인덱스\],      구조)                
                LIBRARIES: \[인덱스\]                            

  9개           문서에 명시적으로 기재      A1 내장에 유사 로직  **🟡 유사**
  가이드라인                                존재 (정확히         
                                            동일한지 미확인)     
  ----------------------------------------------------------------------------

> **분석:** Tool Retriever는 A1 에이전트 내부에서 자동으로 작동하는
> 컴포넌트입니다. Phase 2 문서의 9개 가이드라인이 A1 내장 로직과 정확히
> 동일한지 코드 수준 확인이 필요하지만, 기능적으로는 동일한 역할을
> 수행합니다.

## 2.4 System Prompt for Action Discovery Agent

  -----------------------------------------------------------------------
  **구분**           **내용**
  ------------------ ----------------------------------------------------
  Phase 2 합의 문서  논문에서 computational task를 추출하는 에이전트

  Phase 1 적용 여부  ❌ Phase 1에서 사용하지 않음

  이유               Action Discovery는 Biomni 환경 구축(E1)을 위한
                     프롬프트로, 데이터 수집(Phase 1) 범위가 아님
  -----------------------------------------------------------------------

> **분석:** 이 프롬프트는 Biomni 논문에서 2,500개 논문을 분석하여
> 도구/DB를 추출하는 데 사용된 것입니다. Phase 1의 벤치마크 평가 및
> trajectory 수집과는 무관하며, 비교 대상이 아닙니다.

## 2.5 System Prompt for GPT (Biomni A1) --- 가장 중요한 비교

**이 프롬프트는 Phase 2 문서에서 가장 상세하며, 도메인 특화 지식이 직접
포함되어 있습니다.**

  ---------------------------------------------------------------------------------
  **비교 항목**   **Phase 2 합의 문서**          **Phase 1 실제       **일치 여부**
                                                 사용**               
  --------------- ------------------------------ -------------------- -------------
  기본 에이전트   A1 프롬프트 + 체크리스트 +     A1 기본 프롬프트     **✅ 일치**
  구조            태그                           (동일 구조)          

  PROTOCOL        search_protocols(),            A1 내장에 유사 기능  **🟡 유사**
  GENERATION 섹션 advanced_web_search_claude()   존재                 
                  등 도구 사용 지침                                   

  sgRNA 설계      ✅ 3-tier 접근법 (Addgene DB → ❌ 미포함            **❌ 미포함**
  가이드          CRISPick → De Novo) 전체 포함                       

  PRIORITY CUSTOM ✅ know-how 문서 자동 로드     ❌ 미포함            **❌ 미포함**
  RESOURCES       지침 포함                                           

  CRISPick        ✅ 238개 데이터셋 접근 가이드  ❌ 미포함            **❌ 미포함**
  다운로드 링크                                                       

  도구 목록       literature, bioengineering,    A1 retriever가 자동  **🟡 유사**
  (명시적)        molecular_biology, genetics,   선택 (동적)          
                  genomics, database 6개 모듈                         
                  명시                                                

  Data Lake 항목  McPAS-TCR, DepMap, sgRNA_KO 등 A1이 자동 선택       **🟡 유사**
  (명시적)        4개 데이터셋 명시              (동적)               

  소프트웨어      biopython, scanpy, biotite,    A1이 자동 선택       **🟡 유사**
  라이브러리      gseapy, mageck 5개 명시        (동적)               
  ---------------------------------------------------------------------------------

> **핵심 차이:** Phase 2 문서에는 sgRNA 설계 가이드(3-tier 접근법),
> CRISPick 데이터셋 가이드, know-how 문서 등 도메인 특화 지식이
> 프롬프트에 직접 포함되어 있습니다. Phase 1 수집 시에는 이 도메인
> 지식이 프롬프트에 없었습니다.
>
> **영향도:** CRISPR 관련 태스크(crispr_delivery,
> screen_design_retrieval 등)의 성공률에 영향을 줄 수 있습니다. 다만, A1
> retriever가 동적으로 관련 도구를 선택하므로 실질적 영향은 제한적일 수
> 있습니다.

# 3. 영향도 분석

각 차이점이 Phase 1에서 수집한 데이터(trajectory, GDPO 쌍, SFT 데이터)에
미치는 영향을 분석합니다.

## 3.1 GDPO 학습 데이터 (829쌍)

GDPO 학습 데이터는 trajectory를 chosen/rejected 쌍으로 구성한 것입니다.
trajectory 수집 시 사용된 프롬프트가 다르면 쌍의 품질에 영향을 줄 수
있습니다.

  ------------------------------------------------------------------------
  **데이터**    **프롬프트 영향**      **영향    **근거**
                                       수준**    
  ------------- ---------------------- --------- -------------------------
  Eval1 287쌍   R0/GPT 기본 프롬프트로 🟡 낮음   기본 구조 동일, 도메인
                수집                             지식 차이는 미미

  LAB-Bench     R0/GPT 기본 프롬프트로 🟡 낮음   SeqQA/DbQA는 도구 자동
  542쌍         수집                             선택으로 커버
  ------------------------------------------------------------------------

## 3.2 SFT 데이터 (444건)

SFT 데이터는 정답 trajectory만 사용합니다. 정답을 맞춘 경우 프롬프트
차이의 영향은 더욱 제한적입니다.

  -----------------------------------------------------------------------
  **항목**                       **판단**
  ------------------------------ ----------------------------------------
  프롬프트 차이로 정답률 자체가  낮음 --- A1 retriever가 필요 도구를 동적
  달라졌을 가능성                선택

  정답 trajectory의 품질이       낮음 --- 풀이 과정의
  달라졌을 가능성                구조(think→execute→observe)는 동일
  -----------------------------------------------------------------------

## 3.3 Uncertainty Head 데이터 (433건)

모델 마지막 층의 hidden state만 사용하므로 system prompt와 무관합니다.

**영향 수준: ✅ 없음**

## 3.4 태스크 유형별 영향

  --------------------------------------------------------------------------------
  **태스크 유형**               **Phase 2 문서에 추가된 지식** **영향도**
  ----------------------------- ------------------------------ -------------------
  gwas_causal_gene              없음 (일반 유전자 식별)        ✅ 영향 없음

  gwas_variant_prioritization   없음                           ✅ 영향 없음

  patient_gene_detection        없음                           ✅ 영향 없음

  rare_disease_diagnosis        없음                           ✅ 영향 없음

  lab_bench_seqqa               없음 (A1 retriever가 biopython ✅ 영향 없음
                                자동 선택)                     

  lab_bench_dbqa                없음 (A1 retriever가 DB 도구   ✅ 영향 없음
                                자동 선택)                     

  crispr_delivery               🔴 sgRNA 설계 가이드 포함      🟡 일부 영향 가능

  screen_design_retrieval       🔴 CRISPick 데이터셋 가이드    🟡 일부 영향 가능
                                포함                           
  --------------------------------------------------------------------------------

> **결론:** CRISPR 관련 2개 태스크를 제외하면, 나머지 태스크에서는
> 프롬프트 차이의 영향이 없거나 미미합니다.

# 4. 합의사항 문서 주요 항목과 Phase 1 구현 대조

SWW_합의사항_정리내용 문서의 Phase 2 관련 합의사항이 Phase 1 구현에
어떻게 반영되었는지 대조합니다.

  ----------------------------------------------------------------------------
  **합의     **합의 내용**         **Phase 1 구현**      **비고**
  항목**                                                 
  ---------- --------------------- --------------------- ---------------------
  6-1        학습된 분산 사용 (SFT MLP 기반 Uncertainty  방식 상이하나 목적
             & RLHF에서            Head 구현 (MC dropout 동일
             Uncertainty Head      미사용)               
             학습)                                       

  6-2        Negative sampling in  GDPO에서 rejected     유사 개념
             RLHF                  쌍으로 대체           

  6-3        Partial fine tuning   QLoRA 3.17% 학습 +    접근법 상이
             (레이어 절반 학습 +   DPO beta=0.1          
             KL divergence)                              

  6-4        Uncertainty 임계점    GDPO에서 별도         미반영
             초과 시 보상 0 or -1  uncertainty 보상      
                                   미적용                

  9          PRM: Conditional      미구현 (Phase 2 팀    Phase 2 범위
             Hierarchical Partial  담당)                 
             Reward                                      

  10-1       crispr_delivery 사용  ✅ Eval1에 포함하여   반영됨
                                   수집 완료             

  10-2       lab bench seqqa &     ✅ LAB-Bench 전체     반영됨
             dbqa 사용             1,848건 수집          

  10-3\~11   추가 데이터셋         ✅ Eval1 433건에 포함 반영됨
             (patient_gene,                              
             rare_disease 등)                            
  ----------------------------------------------------------------------------

# 5. 결론 및 권장 조치

## 5.1 종합 판정

  -----------------------------------------------------------------------
  **영역**         **판정**   **설명**
  ---------------- ---------- -------------------------------------------
  에이전트 기본    ✅ 일치    계획 수립, 코드 실행, 태그 형식 등 핵심
  구조                        구조가 동일

  도구 선택        🟡 유사    Phase 2는 명시적 목록, Phase 1은 동적
  메커니즘                    retriever --- 기능적 동등

  도메인 특화 지식 🔴 차이    sgRNA 가이드, CRISPick 가이드 등 Phase 1
                              미포함

  R0 전용 프롬프트 ⚠️ 미확정  Phase 2 문서에 \"ddd\" placeholder --- 확정
                              대기

  데이터 품질 영향 🟡 제한적  CRISPR 관련 2개 태스크 외 영향 미미
  -----------------------------------------------------------------------

## 5.2 데이터 재수집 필요 여부

**현재 시점에서 전체 데이터 재수집은 불필요합니다.**

  -------------------------------------------------------------------------
  **데이터**       **재수집   **근거**
                   필요**     
  ---------------- ---------- ---------------------------------------------
  GDPO 829쌍       ❌ 불필요  에이전트 기본 구조 동일, 도구 자동 선택 기능
                              동등

  SFT 444건        ❌ 불필요  정답 trajectory의 품질은 프롬프트 차이에 둔감

  Uncertainty      ❌ 불필요  hidden state 기반으로 프롬프트 무관
  433건                       

  CRISPR 태스크    🟡 선택적  도메인 지식 추가 시 성공률 개선 가능 →
  일부                        D-scenario 개선과 연계
  -------------------------------------------------------------------------

## 5.3 권장 조치 (3단계)

  -------------------------------------------------------------------------
  **단계**   **조치**                     **담당**         **시기**
  ---------- ---------------------------- ---------------- ----------------
  단기       Phase 2 팀에 R0              Hoony →          이번 주
  (즉시)     프롬프트(\"ddd\") 확정 일정  완수/재현        
             확인                                          

  단기       Phase 1 사용 A1 기본         Hoony            오늘
  (즉시)     프롬프트 원문 추출 → 팀 공유                  

  중기       확정된 커스텀 프롬프트로     Hoony            규칙 #9
  (1\~2주)   CRISPR 관련 태스크 재수집                     
             (D-scenario 개선과 병행)                      

  중기       sgRNA 가이드/CRISPick 지식을 Phase 1+2 협업   수석님 판단 후
  (1\~2주)   프롬프트에 통합하여 추가                      
             실험                                          

  장기       확정된 R0 프롬프트로 전체    Phase 2 팀       R0 프롬프트 확정
  (Phase 2)  파이프라인 재검증                             후
  -------------------------------------------------------------------------

## 5.4 서버에서 확인 필요한 사항

Phase 1이 실제 사용한 A1 기본 프롬프트 원문을 서버에서 추출해야 합니다.
아래 명령어로 확인 가능합니다:

ssh sww@211.206.241.242 -p 22

conda activate biomni-agent

cd \~/aigen-bioagent

\# A1 에이전트 내부 system prompt 추출

python3 -c \"

from biomni.agent import A1

import inspect

src = inspect.getsource(A1)

for i, line in enumerate(src.split(\'\\n\')):

if \'system\' in line.lower() or \'prompt\' in line.lower():

print(f\'{i}: {line.strip()\[:120\]}\')

\" 2\>&1 \| head -30

추출된 원문은 Phase 2 합의 문서와 한 줄 단위 diff 비교에 사용됩니다.

# 용어 주석

  -----------------------------------------------------------------------
  **용어**         **설명**
  ---------------- ------------------------------------------------------
  System Prompt    AI 모델에게 역할과 행동 규칙을 부여하는 초기 지시문.
                   모든 대화에 적용됨

  Biomni A1        Stanford에서 개발한 범용 생의학 에이전트. Phase 1의
                   기본 에이전트 프레임워크

  Biomni R0        Qwen-32B 기반 생의학 추론 모델. 로컬 GPU에서 서빙하여
                   사용

  Retriever        에이전트가 태스크에 맞는 도구/DB를 자동으로 선택하는
                   컴포넌트

  Trajectory       에이전트가 문제를 푸는 전체 과정 (think → execute →
                   observe → solution)

  sgRNA            CRISPR 유전자 편집에서 목표 DNA를 찾아가는 가이드 RNA
                   (20bp 서열)

  CRISPick         Broad Institute에서 제공하는 사전 계산된 sgRNA 설계
                   데이터베이스 (238개 데이터셋)

  D-scenario       두 모델(R0, GPT) 모두 실패한 태스크 137건.
                   프롬프트/도구 개선 대상

  Phase 1          평가 인프라 구축, 벤치마크 래퍼, trajectory 수집
                   (박정훈 담당)

  Phase 2          GDPO 학습, Uncertainty Head, SFT 모델 학습 (구재현,
                   완수 담당)

  vLLM             대형 언어모델을 빠르게 서빙하기 위한 추론 엔진

  GDPO             Group Direct Preference Optimization --- 좋은/나쁜
                   답변 비교를 통한 모델 개선
  -----------------------------------------------------------------------
